<!--
 * @Author: shanlonglong danlonglong@weimiao.cn
 * @Date: 2024-12-27 18:24:39
 * @LastEditors: shanlonglong danlonglong@weimiao.cn
 * @LastEditTime: 2024-12-27 18:30:55
 * @FilePath: \dingding_golang\project_design\table_design.md
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->
## 1. 项目主表单 - 表格展示结构

| **项目名称** | **主要负责人** | **项目状态** | **当前阶段** | **操作**   |
|--------------|----------------|--------------|--------------|------------|
| 项目 A       | 张三           | 进行中        | 准备阶段      | [查看详情] |
| 项目 B       | 李四           | 已完成        | 结束阶段      | [查看详情] |
| 项目 C       | 王五           | 进行中        | 执行阶段      | [查看详情] |

> 建立一个集成自动化

```js
触发条件:
- 数据触发
- 选择项目主表
- 触发动作:记录创建完成

执行动作:
- 发起流程
- 选择立项阶段流程
- 数据映射:
  * 将新建的项目记录ID传给立项流程
  * 将主要负责人信息传给立项流程
```

## 2. 立项阶段流程

| **关联项目**  | **任务内容**     | **执行人**  | **任务状态** | **附件**    | **处理意见**          |
|---------------|------------------|-------------|--------------|-------------|-----------------------|
| 项目 A        | 需求调研         | 张三         | 已完成        | [查看附件]  | 无                    |
| 项目 A        | 方案制定         | 李四         | 进行中        | -           | 需要完善技术细节      |
| 项目 B        | 环境部署         | 王五         | 待执行        | -           | 环境配置暂未开始       |
| 项目 B        | 开发任务         | 李四、王五    | 进行中        | [查看附件]  | 前端开发完成50%        |

设计立项流程:
```js
节点1 - 立项任务发起:
- 表单字段:上述立项阶段表单的所有字段
- 参与人:从集成自动化传入的项目主要负责人
- 可操作:填写具体任务及分配执行人

节点2 - 任务执行:
- 参与人:子表单中的所有执行人(多实例)
- 可编辑字段:任务状态、附件、处理意见
- 审批方式:会签(需所有人完成)

节点3 - 主管确认:
- 参与人:项目主要负责人
- 可操作:审批通过/驳回
- 判断条件:
  * 通过:触发自动化创建准备阶段
```

配置立项结束后的自动化:

```js
触发条件:
- 立项流程结束(主管确认通过)

执行动作:
1. 更新项目主表:
   - 当前阶段改为"准备"
2. 发起准备阶段流程:
   - 传递项目信息
   - 传递主要负责人信息
```


### 3. 创建任务处理表单：

字段设计：
- 关联项目(关联查询项目主表)
- 关联立项表单
- 任务内容(单行文本) 
- 执行人(人员选择)
- 任务状态(单选:待执行/进行中/已完成)
- 附件(附件上传)
- 处理意见(多行文本)

自动化规则

触发条件：
- 立项阶段表单提交(填写完任务列表)

执行动作：
1. 遍历子表单中的任务
2. 为每个任务：
   - 在任务处理表单中创建记录
   - 发送消息给对应的执行人
   - 消息包含处理链接

监控任务完成状态：

触发条件：
- 任务处理表单状态更新为"已完成"

执行动作：
1. 查询当前项目的所有任务
2. 检查是否全部完成
3. 如全部完成：
   - 通知项目负责人审批
   - 更新立项阶段状态